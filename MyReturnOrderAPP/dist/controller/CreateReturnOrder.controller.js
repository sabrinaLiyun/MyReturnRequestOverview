sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","./utilities","sap/ui/core/routing/History"],function(e,t,r,s){"use strict";return e.extend("SAPUI5MyReturnOrder.MyReturnOrderAPP.controller.CreateReturnOrder",{handleRouteMatched:function(e){var t="App5f155bcb6d338e01cd7c2169";var r={};if(e.mParameters.data.context){this.sContext=e.mParameters.data.context}else{if(this.getOwnerComponent().getComponentData()){var s=function(e){if(Object.keys(e).length!==0){for(var t in e){if(t!=="sourcePrototype"&&t.includes("Set")){return t+"("+e[t][0]+")"}}}};this.sContext=s(this.getOwnerComponent().getComponentData().startupParameters)}}var n;if(this.sContext){n={path:"/"+this.sContext,parameters:r};this.getView().bindObject(n)}},_onComboChange:function(e){var t=e.getParameter("selectedItem").getKey();var r=[];r.push(new sap.ui.model.Filter("Customer",sap.ui.model.FilterOperator.EQ,t));var s=this.getView().getModel();s.read("/CustomerData",{filters:r,success:function(e){var t=e.results[0];var r=t.CustomerName;this.getView().byId("Text1").setText(r)}.bind(this)})},_onPageNavButtonPress:function(){var e=s.getInstance();var t=e.getPreviousHash();var r=this.getQueryParameters(window.location);if(t!==undefined||r.navBackToLaunchpad){window.history.go(-1)}else{var n=sap.ui.core.UIComponent.getRouterFor(this);n.navTo("default",true)}},getQueryParameters:function(e){var t={};var r=e.search.substring(1).split("&");for(var s=0;s<r.length;s++){var n=r[s].split("=");t[n[0]]=decodeURIComponent(n[1])}return t},_onButtonPress:function(){return new Promise(function(e){var t="center center";t=t==="default"?undefined:t;sap.m.MessageToast.show("Return Order was created successfully",{onClose:e,duration:3e3||3e3,at:t,my:t})}).catch(function(e){if(e!==undefined){t.error(e.message)}})},_onButtonPress1:function(){return new Promise(function(e){sap.m.MessageBox.confirm("This page contains unsaved data. Do you really want to exit?",{title:"Cancel",actions:["Yes","No"],onClose:function(t){e(t==="Yes")}})}).catch(function(e){if(e!==undefined){t.error(e)}})},onInit:function(){this.oRouter=sap.ui.core.UIComponent.getRouterFor(this);this.oRouter.getTarget("TargetCreateReturnOrder").attachDisplay(jQuery.proxy(this.handleRouteMatched,this))},onSave:function(){var e;var r;var s,n,a,o;var i=this.byId("oTableCreate").getItems();var u=[];for(var l=0;l<i.length;l++){var c=i[l];s=c.getCells()[0].getValue();n=c.getCells()[2].getValue();a=c.getCells()[4].getSelectedKey();o=c.getCells()[5].getSelectedKey();e=c.getCells()[4].getValue();r=c.getCells()[5].getValue();if(s!=""&&n!=""&&e!=""&&r!=""){u.push({Material:s,RequestedQuantity:n,ReturnReason:a,ReturnsRefundType:o,RetsMgmtProcessingBlock:"B"})}}if(u==""){t.error("No items are filled")}else{var d={CustomerReturnType:"YRE2",SalesOrganization:this.byId("Combox_SalesAreaID").getSelectedItem().getText().substring(0,4),DistributionChannel:this.byId("Combox_SalesAreaID").getSelectedItem().getText().substring(5,7),OrganizationDivision:this.byId("Combox_SalesAreaID").getSelectedItem().getText().substring(8,10),SoldToParty:this.byId("Combox_CustomerID").getSelectedItem().getText(),SDDocumentReason:"001",to_Item:{results:u}};this.oModel=this.getView().getModel("ZRETURN_SAP");this.oModel.create("/A_CustomerReturn",d,{refreshAfterChange:true,success:function(e){t.success("Return Order "+e.CustomerReturn+" was created successfully")},error:function(e){t.error("Create return order failed")}});this.onClear()}},onAdd:function(e){var t=this;var r=new sap.m.ColumnListItem({cells:[new sap.m.Input({change:function(e){t.onEnter(e)}}),new sap.m.Text({text:""}),new sap.m.Input,new sap.m.Text({text:"PC"}),new sap.m.ComboBox({items:{path:"zreturn>/ReturnReasonText",template:new sap.ui.core.Item({key:"{zreturn>ReturnReason}",text:"{zreturn>ReturnReasonName}"})}}),new sap.m.ComboBox({items:{path:"zreturn>/RefundTypeText",template:new sap.ui.core.Item({key:"{zreturn>ReturnsRefundType}",text:"{zreturn>RefundTypeDescription}"})}})]});var s=this.getView().byId("oTableCreate");s.addItem(r)},onDelete:function(e){var r=this.getView().byId("oTableCreate");return new Promise(function(e){sap.m.MessageBox.confirm("Do you want to delete it?",{title:"Delete",actions:["Yes","No"],onClose:function(e){if(e==="Yes"){var t=r.getSelectedItems();var s=0;while(s<t.length){r.removeItem(t[s]);s++}}}})}).catch(function(e){if(e!==undefined){t.error(e)}})},onClear:function(){this.byId("Combox_CustomerID").setSelectedKey("");this.byId("Combox_SalesAreaID").setSelectedKey("");var e=this.byId("oTableCreate").getItems();for(var t=0;t<e.length;t++){var r=e[t];r.getCells()[0].setValue("");r.getCells()[1].setText("");r.getCells()[2].setValue("");r.getCells()[3].setText("");r.getCells()[4].setSelectedKey("");r.getCells()[5].setSelectedKey("")}},onTest:function(e){this.byId("Combox_CustomerID").setSelectedKey("");this.byId("Combox_SalesAreaID").setSelectedKey("");var t=this.byId("oTableCreate").getItems();for(var r=0;r<t.length;r++){var s=t[r];s.getCells()[0].setValue("");s.getCells()[2].setValue("");s.getCells()[4].setSelectedKey("");s.getCells()[5].setSelectedKey("")}},onEnter:function(e){var t=e.getSource().getParent();var r=t.getCells();var s=[];var n=this.getView().getModel();var a;var o=r[0].getValue();if(o!=""){s.push(new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("Material",sap.ui.model.FilterOperator.EQ,o),new sap.ui.model.Filter("Language",sap.ui.model.FilterOperator.EQ,"EN")],and:true}));n.read("/MaterialDescription",{filters:s,success:function(e,t){var s=e.results[0];a=s.MaterialName;r[1].setText(a)},error:function(e){this.console.log("Failed")}});r[3].setText("PC")}}})},true);