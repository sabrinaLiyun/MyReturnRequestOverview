sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","./utilities","sap/ui/core/routing/History"],function(e,t,a,s){"use strict";return e.extend("SAPUI5MyReturnOrder.MyReturnOrderAPP.controller.CreateReturnOrder",{handleRouteMatched:function(e){var t="App5f155bcb6d338e01cd7c2169";var a={};if(e.mParameters.data.context){this.sContext=e.mParameters.data.context}else{if(this.getOwnerComponent().getComponentData()){var s=function(e){if(Object.keys(e).length!==0){for(var t in e){if(t!=="sourcePrototype"&&t.includes("Set")){return t+"("+e[t][0]+")"}}}};this.sContext=s(this.getOwnerComponent().getComponentData().startupParameters)}}var r;if(this.sContext){r={path:"/"+this.sContext,parameters:a};this.getView().bindObject(r)}},_onComboChange:function(e){var t=e.getParameter("selectedItem").getKey();var a=[];a.push(new sap.ui.model.Filter("Customer",sap.ui.model.FilterOperator.EQ,t));var s=this.getView().getModel();s.read("/CustomerData",{filters:a,success:function(e){var t=e.results[0];var a=t.CustomerName;this.getView().byId("Text1").setText(a)}.bind(this)})},onHandleChange:function(e){var t=e.getSource(),a=t.getSelectedKey(),s=t.getValue();if(!a&&s){t.setValueState("Error");t.setValueStateText("Please select valid value!")}else{t.setValueState("None")}},onHandleChangeSpecial:function(e){var t=e.getSource(),a=t.getSelectedKey(),s=t.getValue();if(s==="Credit Memo"){t.setValueState("None")}else if(!a&&s){t.setValueState("Error");t.setValueStateText("Please select valid value!")}else{t.setValueState("None")}},_onComboChangeSalesArea:function(e){var t=this.byId("Combox_SalesAreaID").getSelectedKey();if(!t){this.byId("Combox_SalesAreaID").setValueState("Error");this.byId("Combox_SalesAreaID").setValueStateText("Please select valid value!");return}else{this.byId("Combox_SalesAreaID").setValueState("None")}},_onPageNavButtonPress:function(){var e=s.getInstance();var t=e.getPreviousHash();var a=this.getQueryParameters(window.location);if(t!==undefined||a.navBackToLaunchpad){this.onClear();window.history.go(-1)}else{var r=sap.ui.core.UIComponent.getRouterFor(this);r.navTo("RouteReturnOrders",true)}},getQueryParameters:function(e){var t={};var a=e.search.substring(1).split("&");for(var s=0;s<a.length;s++){var r=a[s].split("=");t[r[0]]=decodeURIComponent(r[1])}return t},_onButtonPress:function(){return new Promise(function(e){var t="center center";t=t==="default"?undefined:t;sap.m.MessageToast.show("Return Order was created successfully",{onClose:e,duration:3e3||3e3,at:t,my:t})}).catch(function(e){if(e!==undefined){t.error(e.message)}})},_onButtonPress1:function(){var e=sap.ui.core.UIComponent.getRouterFor(this);var a=this;return new Promise(function(t){sap.m.MessageBox.confirm("This page contains unsaved data. Do you really want to exit?",{title:"Cancel",actions:["Yes","No"],onClose:function(t){if(t==="Yes"){a.onClear();e.navTo("RouteReturnOrders",true)}}})}).catch(function(e){if(e!==undefined){t.error(e)}})},onInit:function(){this.oRouter=sap.ui.core.UIComponent.getRouterFor(this);this.oRouter.getTarget("TargetCreateReturnOrder").attachDisplay(jQuery.proxy(this.handleRouteMatched,this))},onSave:function(){var e;var a;var s,r,l,o;var n=this.byId("oTableCreate").getItems();var i=[];var u=this.byId("Combox_CustomerID").getSelectedKey();var d=this.byId("Combox_SalesAreaID").getSelectedKey();var c="No";if(!u){this.byId("Combox_CustomerID").setValueState("Error");this.byId("Combox_CustomerID").setValueStateText("Please select valid value!");c="Yes"}else{this.byId("Combox_CustomerID").setValueState("None")}if(!d){this.byId("Combox_SalesAreaID").setValueState("Error");this.byId("Combox_SalesAreaID").setValueStateText("Please select valid value!");c="Yes"}else{this.byId("Combox_SalesAreaID").setValueState("None")}if(c==="Yes"){return}for(var g=0;g<n.length;g++){var C=n[g];s=C.getCells()[0].getValue();r=C.getCells()[2].getValue();l=C.getCells()[4].getSelectedKey();o=C.getCells()[5].getSelectedKey();e=C.getCells()[4].getValue();a=C.getCells()[5].getValue();if(s==""&&r==""&&e==""&&a==""){continue}if(s==""){C.getCells()[0].setValueState("Error");C.getCells()[0].setValueStateText("Please input value!");c="Yes"}else{C.getCells()[0].setValueState("None")}if(r==""){C.getCells()[2].setValueState("Error");C.getCells()[2].setValueStateText("Please input value!");c="Yes"}else{C.getCells()[2].setValueState("None")}if(e==""){C.getCells()[4].setValueState("Error");C.getCells()[4].setValueStateText("Please select valid value!");c="Yes"}else{if(!C.getCells()[4].getSelectedKey()){C.getCells()[4].setValueState("Error");C.getCells()[4].setValueStateText("Please select valid value!");c="Yes"}else{C.getCells()[4].setValueState("None")}}if(a==""){C.getCells()[5].setValueState("Error");C.getCells()[5].setValueStateText("Please select valid value!");c="Yes"}else{C.getCells()[5].setValueState("None")}if(s!=""&&r!=""&&e!=""&&a!=""){i.push({Material:s,RequestedQuantity:r,ReturnReason:l,ReturnsRefundType:o,RetsMgmtProcessingBlock:"B"})}}if(c=="Yes"){return}if(i==""){t.error("No items are filled")}else{var m={CustomerReturnType:"YRE2",SalesOrganization:this.byId("Combox_SalesAreaID").getSelectedItem().getText().substring(0,4),DistributionChannel:this.byId("Combox_SalesAreaID").getSelectedItem().getText().substring(5,7),OrganizationDivision:this.byId("Combox_SalesAreaID").getSelectedItem().getText().substring(8,10),SoldToParty:this.byId("Combox_CustomerID").getSelectedItem().getText(),SDDocumentReason:"001",to_Item:{results:i}};this.oModel=this.getView().getModel("ZRETURN_SAP");this.byId("oTableCreate").setBusy(true);this.oModel.create("/A_CustomerReturn",m,{refreshAfterChange:true,success:function(e){this.byId("oTableCreate").setBusy(false);t.success("Return Order "+e.CustomerReturn+" was created successfully");this.onClear()}.bind(this),error:function(e){this.byId("oTableCreate").setBusy(false);t.error("Failed")}.bind(this)})}},onAdd:function(e){var t=this;var a=new sap.m.ColumnListItem({cells:[new sap.m.Input({change:function(e){t.onEnter(e)}}),new sap.m.Text({text:""}),new sap.m.Input,new sap.m.Text({text:""}),new sap.m.ComboBox({items:{path:"zreturn>/ReturnReasonText",template:new sap.ui.core.Item({key:"{zreturn>ReturnReason}",text:"{zreturn>ReturnReasonName}"})},change:function(e){t.onHandleChange(e)}}),new sap.m.ComboBox({items:{path:"zreturn>/RefundTypeText",template:new sap.ui.core.Item({key:"{zreturn>ReturnsRefundType}",text:"{zreturn>RefundTypeDescription}"})},change:function(e){t.onHandleChangeSpecial(e)}})]});var s=this.getView().byId("oTableCreate");s.addItem(a)},onDelete:function(e){var a=this.getView().byId("oTableCreate");return new Promise(function(e){sap.m.MessageBox.confirm("Do you want to delete it?",{title:"Delete",actions:["Yes","No"],onClose:function(e){if(e==="Yes"){var t=a.getSelectedItems();var s=0;while(s<t.length){a.removeItem(t[s]);s++}}}})}).catch(function(e){if(e!==undefined){t.error(e)}})},onClear:function(){this.byId("Combox_CustomerID").setSelectedKey("");this.byId("Combox_SalesAreaID").setSelectedKey("");this.byId("Text1").setText("");var e=this.byId("oTableCreate").getItems();for(var t=0;t<e.length;t++){var a=e[t];a.getCells()[0].setValue("");a.getCells()[1].setText("");a.getCells()[2].setValue("");a.getCells()[3].setText("");a.getCells()[4].setSelectedKey("");a.getCells()[5].setSelectedKey("");a.getCells()[0].setValueState("None");a.getCells()[2].setValueState("None");a.getCells()[4].setValueState("None");a.getCells()[5].setValueState("None")}this.byId("Combox_CustomerID").setValueState("None");this.byId("Combox_SalesAreaID").setValueState("None")},onTest:function(e){this.byId("Combox_CustomerID").setSelectedKey("");this.byId("Combox_SalesAreaID").setSelectedKey("");var t=this.byId("oTableCreate").getItems();for(var a=0;a<t.length;a++){var s=t[a];s.getCells()[0].setValue("");s.getCells()[2].setValue("");s.getCells()[4].setSelectedKey("");s.getCells()[5].setSelectedKey("")}},onEnter:function(e){var t=e.getSource().getParent();var a=t.getCells();var s=[];var r=this.getView().getModel();var l;var o=a[0].getValue();if(o!=""){s.push(new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("Material",sap.ui.model.FilterOperator.EQ,o),new sap.ui.model.Filter("Language",sap.ui.model.FilterOperator.EQ,"EN")],and:true}));r.read("/MaterialDescription",{filters:s,success:function(e,t){var s=e.results[0];if(typeof s!=="undefined"){l=s.MaterialName;a[1].setText(l);a[3].setText("PC");a[0].setValueState("None")}else{a[0].setValueState("Error");a[0].setValueStateText("Please valid value!");a[1].setText("");a[3].setText("")}},error:function(e){this.console.log("Material read failed");a[0].setValueState("Error");a[0].setValueStateText("Please valid value!")}})}else{a[0].setValueState("None")}}})},true);