sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","./utilities","sap/ui/core/routing/History"],function(e,t,a,s){"use strict";return e.extend("SAPUI5MyReturnOrder.MyReturnOrderAPP.controller.CreateReturnOrder",{onInit:function(){this.oRouter=sap.ui.core.UIComponent.getRouterFor(this);this.oRouter.getTarget("TargetCreateReturnOrder").attachDisplay(jQuery.proxy(this.handleRouteMatched,this))},handleRouteMatched:function(e){},onSelectChange:function(e){var t=e.getParameter("selectedItem").getKey();var a=[];a.push(new sap.ui.model.Filter("Customer",sap.ui.model.FilterOperator.EQ,t));var s=this.getView().getModel();s.read("/CustomerData",{filters:a,success:function(e){var t=e.results[0];var a=t.CustomerName;this.getView().byId("Text1").setText(a)}.bind(this)});var l=e.getSource();l.setValueState("None")},onSelectChangeSalesArea:function(e){var t=e.getSource();t.setValueState("None")},onHandleChange:function(e){var t=e.getSource(),a=t.getSelectedKey(),s=t.getValue();if(!a&&s){t.setValueState("Error");t.setValueStateText("Please select valid value!")}else{t.setValueState("None")}},onHandleChangeSpecial:function(e){var t=e.getSource(),a=t.getSelectedKey(),s=t.getValue();if(s==="Credit Memo"){t.setValueState("None")}else if(!a&&s){t.setValueState("Error");t.setValueStateText("Please select valid value!")}else{t.setValueState("None")}},onPageBackPress:function(){this.onClear();var e=sap.ui.core.UIComponent.getRouterFor(this);e.navTo("RouteReturnOrders",true)},onCancel:function(){var e=sap.ui.core.UIComponent.getRouterFor(this);var a=this;return new Promise(function(t){sap.m.MessageBox.confirm("This page contains unsaved data. Do you really want to exit?",{title:"Cancel",actions:["Yes","No"],onClose:function(t){if(t==="Yes"){a.onClear();e.navTo("RouteReturnOrders",true)}}})}).catch(function(e){if(e!==undefined){t.error(e)}})},onSave:function(){var e;var a;var s,l,r,o;var n=this.byId("oTableCreate").getItems();var i=[];var u=this.byId("Combox_CustomerID").getSelectedKey();var d=this.byId("Combox_SalesAreaID").getSelectedKey();var g="No";var c="sapUiResponsivePadding--header sapUiResponsivePadding--content sapUiResponsivePadding--footer";if(!u){this.byId("Combox_CustomerID").setValueState("Error");this.byId("Combox_CustomerID").setValueStateText("Please select valid value!");g="Yes"}else{this.byId("Combox_CustomerID").setValueState("None")}if(!d){this.byId("Combox_SalesAreaID").setValueState("Error");this.byId("Combox_SalesAreaID").setValueStateText("Please select valid value!");g="Yes"}else{this.byId("Combox_SalesAreaID").setValueState("None")}if(g==="Yes"){return}for(var C=0;C<n.length;C++){var m=n[C];s=m.getCells()[0].getValue();l=m.getCells()[2].getValue();r=m.getCells()[4].getSelectedKey();o=m.getCells()[5].getSelectedKey();e=m.getCells()[4].getValue();a=m.getCells()[5].getValue();if(s===""&&l===""&&e===""&&a===""){continue}if(s===""){m.getCells()[0].setValueState("Error");m.getCells()[0].setValueStateText("Please input value!");g="Yes"}else{m.getCells()[0].setValueState("None")}if(l===""){m.getCells()[2].setValueState("Error");m.getCells()[2].setValueStateText("Please input value!");g="Yes"}else{m.getCells()[2].setValueState("None")}if(e===""){m.getCells()[4].setValueState("Error");m.getCells()[4].setValueStateText("Please select valid value!");g="Yes"}else{if(!m.getCells()[4].getSelectedKey()){m.getCells()[4].setValueState("Error");m.getCells()[4].setValueStateText("Please select valid value!");g="Yes"}else{m.getCells()[4].setValueState("None")}}if(a===""){m.getCells()[5].setValueState("Error");m.getCells()[5].setValueStateText("Please select valid value!");g="Yes"}else{m.getCells()[5].setValueState("None")}if(s!==""&&l!==""&&e!==""&&a!==""){i.push({Material:s,RequestedQuantity:l,ReturnReason:r,ReturnsRefundType:o,RetsMgmtProcessingBlock:"B",ReturnsRefundProcgMode:"P",CustRetItmFollowUpActivity:"0001"})}}if(g==="Yes"){return}if(i.length===0){t.error("No items are filled")}else{var S={CustomerReturnType:"YRE2",SalesOrganization:this.byId("Combox_SalesAreaID").getSelectedItem().getText().substring(0,4),DistributionChannel:this.byId("Combox_SalesAreaID").getSelectedItem().getText().substring(5,7),OrganizationDivision:this.byId("Combox_SalesAreaID").getSelectedItem().getText().substring(8,10),SoldToParty:this.byId("Combox_CustomerID").getSelectedItem().getText(),SDDocumentReason:"001",to_Item:{results:i}};this.oModel=this.getView().getModel("ZRETURN_SAP");this.byId("oTableCreate").setBusy(true);this.oModel.create("/A_CustomerReturn",S,{refreshAfterChange:true,success:function(e){this.byId("oTableCreate").setBusy(false);t.success("Return Order "+e.CustomerReturn+" was created successfully");this.onClear()}.bind(this),error:function(e){this.byId("oTableCreate").setBusy(false);t.error("Failed.",{title:"Error",id:"messageBoxId2",details:JSON.parse(e.responseText).error.message.value,contentWidth:"100px",styleClass:c})}.bind(this)})}},onAdd:function(e){var t=this;var a=new sap.m.ColumnListItem({cells:[new sap.m.Input({change:function(e){t.onEnter(e)}}),new sap.m.Text({text:""}),new sap.m.Input,new sap.m.Text({text:""}),new sap.m.ComboBox({items:{path:"zreturn>/ReturnReasonText",template:new sap.ui.core.Item({key:"{zreturn>ReturnReason}",text:"{zreturn>ReturnReasonName}"})},change:function(e){t.onHandleChange(e)}}),new sap.m.ComboBox({items:{path:"zreturn>/RefundTypeText",template:new sap.ui.core.Item({key:"{zreturn>ReturnsRefundType}",text:"{zreturn>RefundTypeDescription}"})},change:function(e){t.onHandleChangeSpecial(e)}})]});var s=this.getView().byId("oTableCreate");s.addItem(a)},onDelete:function(e){var a=this.getView().byId("oTableCreate");return new Promise(function(e){sap.m.MessageBox.confirm("Do you want to delete it?",{title:"Delete",actions:["Yes","No"],onClose:function(e){if(e==="Yes"){var t=a.getSelectedItems();var s=0;while(s<t.length){a.removeItem(t[s]);s++}}}})}).catch(function(e){if(e!==undefined){t.error(e)}})},onClear:function(){this.byId("Combox_CustomerID").setSelectedKey("");this.byId("Combox_SalesAreaID").setSelectedKey("");this.byId("Text1").setText("");var e=this.byId("oTableCreate").getItems();var t=this.getView().byId("oTableCreate");t.removeSelections();for(var a=0;a<e.length;a++){var s=e[a];s.getCells()[0].setValue("");s.getCells()[1].setText("");s.getCells()[2].setValue("");s.getCells()[3].setText("");s.getCells()[4].setSelectedKey("");s.getCells()[5].setSelectedKey("");s.getCells()[0].setValueState("None");s.getCells()[2].setValueState("None");s.getCells()[4].setValueState("None");s.getCells()[5].setValueState("None");if(a>9){t.removeItem(s)}}this.byId("Combox_CustomerID").setValueState("None");this.byId("Combox_SalesAreaID").setValueState("None");var l=e.length;if(l<10){do{this.onAdd();l++}while(l<10)}},onEnter:function(e){var t=e.getSource().getParent();var a=t.getCells();var s=[];var l=this.getView().getModel();var r;var o=a[0].getValue();if(o!==""){s.push(new sap.ui.model.Filter({filters:[new sap.ui.model.Filter("Material",sap.ui.model.FilterOperator.EQ,o),new sap.ui.model.Filter("Language",sap.ui.model.FilterOperator.EQ,"EN")],and:true}));l.read("/MaterialDescription",{filters:s,success:function(e,t){var s=e.results[0];if(typeof s!=="undefined"){r=s.MaterialName;a[1].setText(r);a[3].setText("PC");a[0].setValueState("None")}else{a[0].setValueState("Error");a[0].setValueStateText("Please input valid value!");a[1].setText("");a[3].setText("")}},error:function(e){this.console.log("Material read failed");a[0].setValueState("Error");a[0].setValueStateText("Please input valid value!")}})}else{a[0].setValueState("None")}}})},true);